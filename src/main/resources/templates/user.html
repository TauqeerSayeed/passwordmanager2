<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>User Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
    <script>
        function searchSystem() {
            let input = document.getElementById("searchInput").value.toLowerCase();
            let rows = document.getElementById("dataTable").getElementsByTagName('tbody')[0].rows;
            for(let i=0; i<rows.length; i++){
                let systemCell = rows[i].cells[1].innerText.toLowerCase();
                if(systemCell.includes(input)) {
                    rows[i].style.display = "";
                } else {
                    rows[i].style.display = "none";
                }
            }
        }

        function copyToClipboard(content, buttonElement) {
            const originalTitle = buttonElement.title;
            navigator.clipboard.writeText(content).then(() => {
                const originalSvg = buttonElement.innerHTML;

                // Temporarily replace with a checkmark icon for feedback
                buttonElement.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                    </svg>
                `;
                buttonElement.title = 'Copied!';

                setTimeout(() => {
                    buttonElement.innerHTML = originalSvg;
                    buttonElement.title = originalTitle;
                }, 1500);
            }).catch(err => {
                console.error('Could not copy text: ', err);
                alert('Copy failed. Please try again or copy manually.');
            });
        }
    </script>
</head>
<body class="bg-gray-100 min-h-screen p-4 sm:p-8">

<div class="max-w-7xl mx-auto">

    <div class="flex justify-between items-center mb-6 border-b pb-2">
        <h2 class="text-3xl font-extrabold text-gray-900">ðŸ“‚ User Dashboard</h2>

        <form th:action="@{/logout}" method="post">
            <button type="submit" class="bg-red-500 text-white font-medium px-4 py-2 rounded-lg shadow-md hover:bg-red-600 transition duration-200">
                Logout
            </button>
        </form>

    </div>

    <input type="text" id="searchInput" onkeyup="searchSystem()" placeholder="ðŸ” Search by System Name..." class="border border-gray-300 p-3 rounded-lg mb-6 w-full max-w-lg focus:ring-indigo-500 focus:border-indigo-500">

    <div class="bg-white shadow-lg rounded-xl overflow-hidden">
        <div class="overflow-x-auto">
            <table id="dataTable" class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">#</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">System</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Environment</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">URL</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Username</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Password</th>
                </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                <tr th:each="entry, iterStat : ${entries}" class="hover:bg-gray-50 transition duration-150">
                    <td class="px-6 py-3 whitespace-nowrap text-sm font-medium text-gray-900" th:text="${iterStat.index + 1}"></td>
                    <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-700" th:text="${entry.system}"></td>
                    <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-700" th:text="${entry.environment}"></td>

                    <td class="px-6 py-3 whitespace-nowrap text-sm">
                        <div class="flex items-center space-x-2">
                            <a th:href="${entry.url}" target="_blank" class="text-indigo-600 hover:text-indigo-900 truncate max-w-[150px] inline-block" th:text="${entry.url}"></a>
                            <button onclick="copyToClipboard(this.previousElementSibling.innerText, this)"
                                    class="text-gray-400 hover:text-indigo-600 focus:outline-none transition duration-150 p-1 rounded-full hover:bg-gray-200"
                                    title="Copy URL">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                                </svg>
                            </button>
                        </div>
                    </td>

                    <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-700">
                        <div class="flex items-center justify-between space-x-2">
                            <span th:id="'username-' + ${entry.id}" th:text="${entry.username}"></span>
                            <button onclick="copyToClipboard(this.previousElementSibling.innerText, this)"
                                    class="text-gray-400 hover:text-indigo-600 focus:outline-none transition duration-150 p-1 rounded-full hover:bg-gray-200"
                                    title="Copy Username">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                                </svg>
                            </button>
                        </div>
                    </td>

                    <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-700">
                        <div class="flex items-center justify-between space-x-2">
                            <span th:id="'password-' + ${entry.id}" th:text="${entry.password}"></span>
                            <button onclick="copyToClipboard(this.previousElementSibling.innerText, this)"
                                    class="text-gray-400 hover:text-indigo-600 focus:outline-none transition duration-150 p-1 rounded-full hover:bg-gray-200"
                                    title="Copy Password">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
</body>
</html>